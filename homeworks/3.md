# Домашнее задание к занятию 3. Взаимодействие со сторонними сервисами 
Для получения коротких текстовых ответов на тектовые вопросы существует удобный сервис от Wolfram Alpha, а именно [Short Answer API.](https://products.wolframalpha.com/simple-api/documentation/). В этом домашнем задании Вам необходимо добавить взаимодействи с этим сервисом в Ваше приложение.
 

## Задание 1
Зарегистрируйтесь как разработчик в Wolfram Alpha по [ссылке](https://account.wolfram.com/login/create).

![](ДЗ3/1_1.png)

Затем получите AppId. Обратите внимание, что после получения AppId надо подождать несколько часов, прежде чем он начнет работать.

*Добавить скриншот*
![](ДЗ3/1_2.png)

## Задание 2
Добавьте **Wolfram Alpha SDK** в приложение.

### Инструкция
1.Перейдите на [страницу библиотек Wolfram Alpha.](https://products.wolframalpha.com/api/libraries.html) Выберите Java. Нажмите Download. После этого должен скачаться zip-архив. Внутри несколько файлов, в том числе файл с расширением `jar`.

![](ДЗ3/2_1.png)

2. Поместите файл библиотеки `WolframAlpha-1.1.jar` в папку `libs`.

![](ДЗ3/2_2.png)

3. Добавим папку `libs` как источник библиотек (если этого еще не сделано). Для этого откройте файл `build.gradle` в модуле `app`. Воспользуйтесь поиском (двойное нажатие на Shift), на этот раз по файлам. Введите `build.gradle` и выбирете тот, около которого написано `app`. Там находится список всех библиотек проекта.

![](ДЗ3/2_3.png)

4. *Разобраться*

![](ДЗ3/2_4.png)

5. Запустите действие `Sync Project with Gradle Files` из поиска (2 * Shift), чтобы обновить зависимости и подключить библиотеку.

![](ДЗ3/2_5.png)

6. Включите поддержку http и старой библиотеки. Для этого в файле `AndroidManifest.xml` добавьте строки 

```xml
android:usesCleartextTraffic="true"
```

и 

```xml
<uses-library android:name="org.apache.http.legacy" android:required="false"/>
```

![](ДЗ3/2_6.png)


## Задание 3


## Инструкция по выполнению домашнего задания

1. Получите доступ к полю вывода ответа внутри метода `askWolfram`.

```kotlin
val answerText = findViewById<TextView>(R.id.answer_output)
```

2. Установите начальный текст ответа.

```kotlin
answerText.text = "Let me think..."
```

3. Помните, что этот запрос нужно выполнить на другом потоке, так как в нем происходит сетевой запрос.

```kotlin
val queryResult = engine.performQuery(query)
```

4. Поэтому он должен находиться внутри:

```kotlin
Thread(Runnable {
    ...
}).start()
```

5. После его выполнения у вас есть результат, queryResult, которые нужно отобразить в интерфейсе.

```kotlin
fun askWolfram(question: String) {
        ...

        val answerText = findViewById<TextView>(R.id.answer_output)
        answerText.text = "Let me think..."

        Thread(Runnable {
            val queryResult = engine.performQuery(query)

            answerText.post {
                ...
            }
        }).start()
    }
```

6. Везде, где вы выводите текст в Log, выведите тот же текст в поле ответа с помощью:

```kotlin
answerText.text = "..."
```

7. В итоге метод выглядит так:

```kotlin
fun askWolfram(question: String) {
        val wolframAppId = "DEMO" // тут можно использовать ваш AppId, тогда можно будет задавать любые вопросы

        val engine = WAEngine()
        engine.appID = wolframAppId
        engine.addFormat("plaintext")

        val query = engine.createQuery()
        query.input = question

        val answerText = findViewById<TextView>(R.id.answer_output)
        answerText.text = "Let me think..."

        Thread(Runnable {
            val queryResult = engine.performQuery(query)

            answerText.post {
                if (queryResult.isError) {
                    Log.e("wolfram error", queryResult.errorMessage)
                    answerText.text = queryResult.errorMessage
                } else if (!queryResult.isSuccess) {
                    Log.e("wolfram error", "Sorry, I don't understand, can you rephrase?")
                    answerText.text = "Sorry, I don't understand, can you rephrase?"
                } else {
                    for (pod in queryResult.pods) {
                        if (!pod.isError) {
                            for (subpod in pod.subpods) {
                                for (element in subpod.contents) {
                                    if (element is WAPlainText) {
                                        Log.d("wolfram", element.text)
                                        answerText.text = element.text
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }).start()
    }
```

Любые вопросы по решению задач задавайте в чате в Telegram.

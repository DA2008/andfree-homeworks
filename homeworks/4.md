# Домашнее задание к занятию 4. Добавление голосового интерфейса

Взаимодествовать с приложением можно не только нажатием клавиш, но и с помощью голоса. Если вы занимаетесь какими-то делами или находитесь в дороге, куда удобнее и быстрее произнести свой вопрос, чем печатать его. Вероятно, владельцы смарт-устройств, управляемых голосом, уже оценили это преимущетво. В рамках этого домашнего задания предлагаем вам добавить голосовой интерфейс в ваше приложение. 

## Задание 1
Запустите приложение на реальном устройстве под операционной системой Android при наличие устройтва. Функция распознавания голоса не всегда работает на эмуляторе.

Инструкция доступна по [ссылке](https://github.com/netology-code/guides/blob/master/android/device/instruction.md).

## Задание 2
Реализуйте функцию распознавания голоса в вашем приложении.

### Инструкция

1. Сначала добавьте отправку запроса в систему на распознавание голоса в приложении. Для этого откройте файл `MainActivity.kt`.

1.1 Создайте сам запрос, для этого создайте класс `Intent`. Констурктору класса передайте действие - распознавание речи - `ACTION_RECOGNIZE_SPEECH`. 

```Kotlin
val intent = Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH)
```

Добавьте информацию о языке - Wolfram Alpha отвечает на вопросы на английском, поэтому устанавите `Locale.US`

```Kotlin
intent.putExtra(
   RecognizerIntent.EXTRA_LANGUAGE_MODEL,
   RecognizerIntent.LANGUAGE_MODEL_FREE_FORM
)
intent.putExtra(RecognizerIntent.EXTRA_LANGUAGE, Locale.US)
```

Устанавите сообщение, которое будет показываться перед распознаванием голоса:

```Kotlin
intent.putExtra(RecognizerIntent.EXTRA_PROMPT, "What do you want to know?")
```

1.2 Отправте запрос в систему с помощью метода `startActivityForResult`.

```Kotlin
try {
   startActivityForResult(intent, speechToTextRequestCode)
} catch (a: ActivityNotFoundException) {
   Toast.makeText(
       applicationContext,
       "Sorry your device not supported",
       Toast.LENGTH_SHORT
   ).show()
}
```

1.3 Установите это действие на нажатие на кнопку `speak_button` , этот код поместите в `onCreate` сразу после обработчика кнопки `searchButton`.

```Kotlin
val speakButton = findViewById<Button>(R.id.speak_button)
speakButton.setOnClickListener {
   val intent = Intent(RecognizerIntent.ACTION_RECOGNIZE_SPEECH)
   intent.putExtra(
       RecognizerIntent.EXTRA_LANGUAGE_MODEL,
       RecognizerIntent.LANGUAGE_MODEL_FREE_FORM
   )
   intent.putExtra(RecognizerIntent.EXTRA_LANGUAGE, Locale.US)
   intent.putExtra(RecognizerIntent.EXTRA_PROMPT, "What do you want to know?")
   try {
       startActivityForResult(intent, 1)
   } catch (a: ActivityNotFoundException) {
       Toast.makeText(
           applicationContext,
           "Sorry your device not supported",
           Toast.LENGTH_SHORT
       ).show()
   }
}
```

Итоговый код в файле `MainActivity.kt`:

![](ДЗ4/1_1.png) 
![](ДЗ4/1_2.png) 

2. Получите результат распознования и запишите его в текстовое поле.

Для получение ответа используйте функцию:

```Kotlin
override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
...
}
```

Сначала вызовите системную реализацию этого метода через `super.onActivityResult(requestCode, resultCode, data)` . Затем проверьте, на ваш ли запрос пришел ответ: 

```Kotlin
startActivityForResult(intent, 1)
```

соответственно, в ответе requestCode должен быть равен 1.

Дальше проверка, удачно ли выподнился запрос и есть ли какая-то информация в ответе.

resultCode == RESULT_OK && data != null

Если все эти условия выполняются, мы получаем результат из ответного Intent’a

val result: ArrayList<String>? = data.getStringArrayListExtra(RecognizerIntent.EXTRA_RESULTS)
val question: String? = result?.get(0)

и выводим его в текстовое поле вопроса.

if (question != null) {
       findViewById<TextView>(R.id.question_input).text = question
}







На занятии мы уже научились отправлять запрос на распознавание голоса, получать результат распозвонвани и записывать его в поле, воспроизводить ответ при нажатии на кнопку. Предлагаем улучшить наше приложение, сделать некоторые функции атоматическими, уменьшить колличество действий для пользователя нашего приложения. 

### Инструкция

Запустите функцию `askWolfram` внутри `onActivityResult` автоматически, сразу после записи вопроса в текстовое поле.

```Kotlin
override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {
   super.onActivityResult(requestCode, resultCode, data)
   if (requestCode == 1) {
       if (resultCode == RESULT_OK && data != null) {
           ...
           if (question != null) {
               findViewById<TextView>(R.id.question_input).text = question
               askWolfram(question)
           }
       }
   }
}
```


## Задание 2
Реализуйте автоматический вопроизведение ответа голосом.

### Инструкция

Дайте доступ к объекту TextToSpeech функции `askWolfram`.
Внесите объявление переменной `val tts` на уровень класса. Все переменные, определенные на уровне класса доступны всем методам в этом классе. 
```Kotlin
class MainActivity : AppCompatActivity() {

   lateinit var tts: TextToSpeech
   var speechRequest = 0

   override fun onCreate(savedInstanceState: Bundle?) {
    ...
    val answerOutput = findViewById<TextView>(R.id.answer_output)

    tts = TextToSpeech(this, TextToSpeech.OnInitListener {  })
    tts.language = Locale.US

    findViewById<FloatingActionButton>(R.id.read_answer).setOnClickListener {
    …
}
```

`lateinit` - значит, что вы сможете определить значение позже (например, в методе `onCreate, tts = TextToSpeech(...)`)

Теперь в `askWolfram`, когда будет получен ответ, сразу можно запустить чтение вслух.

```Kotlin
fun askWolfram(question: String) {
                   ...
                   if (element is WAPlainText) {
                       Log.d("wolfram", element.text)
                       answerText.text = element.text
                      findViewById<FloatingActionButton>(R.id.read_answer).setOnClickListener            
                      {
                           val answer = findViewById<TextView>(R.id.answer_output).text.toString()
                           tts.speak(answer, TextToSpeech.QUEUE_ADD, null, speechRequest.toString())
                           speechRequest += 1
                       }
                    }
                  ...
}
```


Любые вопросы по решению задач задавайте в чате в Telegram.
